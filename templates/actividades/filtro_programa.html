{% extends "actividades/base.html" %}
{% block title %}Filtros : Por Programa{% endblock %}
{% load staticfiles %}

{% block extra_head %}
<link href="{% static 'actividades/css/formee/css/form-structure.css' %}" rel="stylesheet" type="text/css"/>
<link href="{% static 'actividades/css/formee/css/form-style.css' %}" rel="stylesheet" type="text/css"/> 
<link href="{% static 'actividades/css/jquery.multiselect.css' %}" rel="stylesheet" type="text/css"/>
<script src="{% static 'actividades/js/jquery.multiselect.filter.js' %}" type="text/javascript"></script>
<script src="{% static 'actividades/js/jquery.multiselect.min.js' %}" type="text/javascript"></script>


<style type="text/css">
	#id_resultado, #id_anio{
		width: 320px !important;
	}
	.content .wrapper{
		margin-bottom: 50px;
		margin-top: 15px;
	}
	label{
		float: left;
		padding-right: 20px;	
	}
	.ui-datepicker{
	 	font-size:13px !important;
	}	
</style>
{% endblock %}

{% block contenido %}
<div class="banner banner-filtros">	
	<div class="title">Filtros de programa</div>
</div>
<div>	
	<div class="formfiltros">			
		<center>		
		<form action="." method="post" class="form">
			{% csrf_token %}
			<table>
				{{form.as_table}}
			</table>
			<input class="form-button" type="submit" value="Consultar" />	
		</form>
		<div>		
		{% for result in resultados %}
		<a href="/proyecto/resultado/{{result.id}}/">{{result.nombre_corto}}</a>
		{% endfor %}
		</div>
		</center>
	</div>
</div>
 
{% endblock %}


{% block extra_js %}
	<script src="{% static 'actividades/js/jquery.multiselect.min.js' %}" type="text/javascript"></script>

  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>



<script type="text/javascript">
$(document).ready(function(){
	$("#id_proyectos").html('');
	$("#id_meses").multiselect({
	    noneSelectedText: 'Meses',
	    selectedText: '# seleccionados',
	    minWidth: 150	    
	});	
	var proyecto = $("#id_proyectos").multiselect({
	    noneSelectedText: 'Seleccione una...',
	    selectedText: '# seleccionados',	       
	});
	$("#id_organizaciones").multiselect({
	    noneSelectedText: 'Seleccione una...',
	    selectedText: '# seleccionados',
	    beforeclose: function(event, ui){
            var selectos = $("#id_organizaciones").multiselect("getChecked").map(function(){
                return this.value;
            }).get();
            if(selectos.length!=0){
                $.getJSON('/ajax/proyectos/?ids='+selectos.join(","), function(data){                	
                    if(data){                    	
                    	$('#id_proyectos').html('');                                                                                 
                        $.each(data, function(i, item){
                        	$('<option></option>').val(item.id)
                        	.html(item.organizacion__nombre_corto+'-'+item.codigo)
                        	.appendTo(proyecto)
                        });
                        proyecto.multiselect('refresh');                        
                    }
                });
                proyecto.multiselect("enable");
            }else{
                proyecto.multiselect("disable");                
            }
        }
	});
	proyecto.multiselect("disable");																					
});


</script>

<script>
$( "#id_fecha_inicio, #id_fecha_fin" ).datepicker({
	altFormat: "dd/mm/yy",
	monthNamesShort: [ "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
						"Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre" ],
	dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sab'],
	rRange: '2014:2018',
	changeMonth: true,
	changeYear: true,
});
</script>
{% endblock %}
